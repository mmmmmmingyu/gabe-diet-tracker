<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GËÉñÈ•ÆÈ£üÁÆ°ÂÆ∂ - ‰Ω†ÁöÑÂÅ•Â∫∑È•ÆÈ£üÂä©Êâã</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --gabe-orange: #ff6b35;
            --gabe-dark: #1a1a2e;
            --gabe-purple: #6b5b95;
            --gabe-green: #88d8b0;
            --gabe-yellow: #ffcc5c;
            --gabe-pink: #ff6f69;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--gabe-dark) 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            padding-bottom: 80px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--gabe-orange) 0%, var(--gabe-pink) 100%);
            padding: 20px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 10px 40px rgba(255, 107, 53, 0.3);
        }
        
        .header-top {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .gabe-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: gabeBounce 2s ease-in-out infinite;
        }
        
        @keyframes gabeBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .header-title h1 {
            font-size: 20px;
            margin-bottom: 3px;
        }
        
        .header-title p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* User Stats Card */
        .user-stats {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-box {
            flex: 1;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .stat-box:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        .stat-box .label {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .stat-box .value {
            font-size: 18px;
            font-weight: bold;
        }
        
        /* Calorie Ring */
        .calorie-section {
            padding: 20px;
        }
        
        .calorie-card {
            background: linear-gradient(135deg, rgba(107, 91, 149, 0.8) 0%, rgba(107, 91, 149, 0.4) 100%);
            border-radius: 25px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .calorie-ring {
            width: 180px;
            height: 180px;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .calorie-ring svg {
            transform: rotate(-90deg);
        }
        
        .calorie-ring-bg {
            fill: none;
            stroke: rgba(255,255,255,0.1);
            stroke-width: 12;
        }
        
        .calorie-ring-progress {
            fill: none;
            stroke: url(#calorieGradient);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.8s ease;
        }
        
        .calorie-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .calorie-text .current {
            font-size: 36px;
            font-weight: bold;
            color: var(--gabe-yellow);
        }
        
        .calorie-text .target {
            font-size: 14px;
            opacity: 0.7;
        }
        
        .macro-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        
        .macro-item {
            text-align: center;
        }
        
        .macro-item .bar {
            width: 50px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            margin: 8px auto;
            overflow: hidden;
        }
        
        .macro-item .bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        .macro-item.protein .bar-fill { background: var(--gabe-pink); }
        .macro-item.carbs .bar-fill { background: var(--gabe-yellow); }
        .macro-item.fat .bar-fill { background: var(--gabe-orange); }
        
        /* Meal Timeline */
        .meals-section {
            padding: 0 20px 20px;
        }
        
        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-title h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-nav {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .date-nav button {
            background: none;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
        }
        
        .meal-timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .meal-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--gabe-orange) 0%, var(--gabe-purple) 100%);
        }
        
        .meal-item {
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }
        
        .meal-item:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(5px);
        }
        
        .meal-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: var(--gabe-orange);
            border-radius: 50%;
            border: 3px solid var(--gabe-dark);
        }
        
        .meal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .meal-type {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .meal-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .meal-icon.breakfast { background: linear-gradient(135deg, #ffcc5c, #ff9f43); }
        .meal-icon.lunch { background: linear-gradient(135deg, #ff6f69, #ff6b35); }
        .meal-icon.dinner { background: linear-gradient(135deg, #6b5b95, #5f4b8b); }
        .meal-icon.snack { background: linear-gradient(135deg, #88d8b0, #2ecc71); }
        
        .meal-info h4 {
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .meal-info span {
            font-size: 11px;
            opacity: 0.6;
        }
        
        .meal-calories {
            font-size: 16px;
            font-weight: bold;
            color: var(--gabe-yellow);
        }
        
        .meal-foods {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .food-tag {
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .food-tag img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Empty State */
        .empty-meals {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.6;
        }
        
        .empty-meals .gabe-hint {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        /* FAB */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--gabe-orange) 0%, var(--gabe-pink) 100%);
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.5);
            transition: all 0.3s;
            z-index: 100;
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: flex-end;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(180deg, #1e2a4a 0%, var(--gabe-dark) 100%);
            width: 100%;
            max-width: 480px;
            height: 100%;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--gabe-orange) 0%, var(--gabe-pink) 100%);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
        }
        
        .close-btn {
            position: absolute;
            right: 20px;
            top: 20px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--gabe-orange);
            background: rgba(255,255,255,0.1);
        }
        
        .meal-type-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .meal-type-option {
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .meal-type-option:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .meal-type-option.selected {
            border-color: var(--gabe-orange);
            background: rgba(255, 107, 53, 0.2);
        }
        
        .meal-type-option .icon {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .meal-type-option .name {
            font-size: 12px;
        }
        
        /* Photo Upload */
        .photo-upload {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .photo-upload:hover {
            border-color: var(--gabe-orange);
            background: rgba(255, 107, 53, 0.05);
        }
        
        .photo-upload.has-image {
            padding: 0;
            border-style: solid;
        }
        
        .photo-upload img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
        }
        
        .photo-upload .upload-hint {
            color: rgba(255,255,255,0.6);
        }
        
        .photo-upload .upload-hint .icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        /* Food List */
        .food-list {
            margin-top: 20px;
        }
        
        .food-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .food-info h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .food-info p {
            font-size: 12px;
            opacity: 0.6;
        }
        
        .food-calories {
            text-align: right;
        }
        
        .food-calories .cal {
            font-size: 18px;
            font-weight: bold;
            color: var(--gabe-yellow);
        }
        
        .food-calories .weight {
            font-size: 11px;
            opacity: 0.6;
        }
        
        /* Add Food Button */
        .add-food-btn {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .add-food-btn:hover {
            border-color: var(--gabe-orange);
            background: rgba(255, 107, 53, 0.1);
        }
        
        /* AI Analysis Result */
        .ai-result {
            background: linear-gradient(135deg, rgba(136, 216, 176, 0.2) 0%, rgba(136, 216, 176, 0.05) 100%);
            border: 1px solid rgba(136, 216, 176, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .ai-result h4 {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gabe-green);
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .ai-result p {
            font-size: 13px;
            line-height: 1.6;
            opacity: 0.9;
        }
        
        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--gabe-orange) 0%, var(--gabe-pink) 100%);
            border: none;
            border-radius: 15px;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
        }
        
        /* Profile Modal */
        .bmi-display {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .bmi-value {
            font-size: 48px;
            font-weight: bold;
            color: var(--gabe-yellow);
        }
        
        .bmi-status {
            font-size: 16px;
            margin-top: 5px;
        }
        
        .bmi-status.normal { color: var(--gabe-green); }
        .bmi-status.overweight { color: var(--gabe-yellow); }
        .bmi-status.obese { color: var(--gabe-pink); }
        .bmi-status.underweight { color: var(--gabe-purple); }
        
        /* Advice Card */
        .advice-card {
            background: linear-gradient(135deg, rgba(107, 91, 149, 0.3) 0%, rgba(107, 91, 149, 0.1) 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
        }
        
        .advice-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .advice-card p {
            font-size: 14px;
            line-height: 1.8;
            opacity: 0.9;
        }
        
        /* Food Search */
        .food-search {
            position: relative;
        }
        
        .food-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #2a3a5a;
            border-radius: 12px;
            margin-top: 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        
        .food-search-results.active {
            display: block;
        }
        
        .food-search-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .food-search-item:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .food-search-item:last-child {
            border-bottom: none;
        }
        
        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading.active {
            display: flex;
        }
        
        .loading-gabe {
            font-size: 64px;
            animation: gabeSpin 1s linear infinite;
        }
        
        @keyframes gabeSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading p {
            margin-top: 20px;
            font-size: 16px;
            opacity: 0.8;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- SVG Gradients -->
        <svg width="0" height="0">
            <defs>
                <linearGradient id="calorieGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#ffcc5c"/>
                    <stop offset="50%" style="stop-color:#ff6b35"/>
                    <stop offset="100%" style="stop-color:#ff6f69"/>
                </linearGradient>
            </defs>
        </svg>

        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="gabe-avatar">üé©</div>
                <div class="header-title">
                    <h1>GËÉñÈ•ÆÈ£üÁÆ°ÂÆ∂</h1>
                    <p>"‰Ω†ÁöÑÈí±ÂåÖÁò¶‰∫ÜÔºå‰ΩÜ‰Ω†Âë¢Ôºü"</p>
                </div>
            </div>
            <div class="user-stats">
                <div class="stat-box" onclick="openProfileModal()">
                    <div class="label">Ë∫´È´ò</div>
                    <div class="value" id="userHeight">--</div>
                </div>
                <div class="stat-box" onclick="openProfileModal()">
                    <div class="label">‰ΩìÈáç</div>
                    <div class="value" id="userWeight">--</div>
                </div>
                <div class="stat-box" onclick="openProfileModal()">
                    <div class="label">BMI</div>
                    <div class="value" id="userBMI">--</div>
                </div>
            </div>
        </div>

        <!-- Calorie Ring -->
        <div class="calorie-section">
            <div class="calorie-card">
                <div class="calorie-ring">
                    <svg width="180" height="180">
                        <circle class="calorie-ring-bg" cx="90" cy="90" r="78"/>
                        <circle class="calorie-ring-progress" id="calorieProgress" cx="90" cy="90" r="78"
                            stroke-dasharray="490" stroke-dashoffset="490"/>
                    </svg>
                    <div class="calorie-text">
                        <div class="current" id="currentCalories">0</div>
                        <div class="target">/ <span id="targetCalories">2000</span> kcal</div>
                    </div>
                </div>
                <div class="macro-stats">
                    <div class="macro-item protein">
                        <div class="label">ËõãÁôΩË¥®</div>
                        <div class="bar"><div class="bar-fill" id="proteinBar" style="width: 0%"></div></div>
                        <div class="value" id="proteinValue">0g</div>
                    </div>
                    <div class="macro-item carbs">
                        <div class="label">Á¢≥Ê∞¥</div>
                        <div class="bar"><div class="bar-fill" id="carbsBar" style="width: 0%"></div></div>
                        <div class="value" id="carbsValue">0g</div>
                    </div>
                    <div class="macro-item fat">
                        <div class="label">ËÑÇËÇ™</div>
                        <div class="bar"><div class="bar-fill" id="fatBar" style="width: 0%"></div></div>
                        <div class="value" id="fatValue">0g</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advice Card -->
        <div class="advice-card" id="adviceCard" style="display: none;">
            <h3>üí° GËÉñÁöÑÈ•ÆÈ£üÂª∫ËÆÆ</h3>
            <p id="adviceText">Âä†ËΩΩ‰∏≠...</p>
        </div>

        <!-- Meals Section -->
        <div class="meals-section">
            <div class="section-title">
                <h2>üçΩÔ∏è ‰ªäÊó•È•ÆÈ£üËÆ∞ÂΩï</h2>
                <div class="date-nav">
                    <button onclick="changeDate(-1)">‚Äπ</button>
                    <span id="currentDate">‰ªäÂ§©</span>
                    <button onclick="changeDate(1)">‚Ä∫</button>
                </div>
            </div>
            <div class="meal-timeline" id="mealTimeline">
                <!-- Meals will be rendered here -->
            </div>
            <div class="empty-meals" id="emptyMeals">
                <div class="gabe-hint">üçî</div>
                <p>‰ªäÂ§©ËøòÊ≤°ÊúâËÆ∞ÂΩïÈ•ÆÈ£üÂì¶~</p>
                <p style="font-size: 12px; margin-top: 10px;">ÁÇπÂáªÂè≥‰∏ãËßíÊåâÈíÆÂºÄÂßãËÆ∞ÂΩï</p>
            </div>
        </div>
    </div>

    <!-- FAB -->
    <button class="fab" onclick="openAddMealModal()">+</button>

    <!-- Add Meal Modal -->
    <div class="modal" id="addMealModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù ËÆ∞ÂΩïÈ•ÆÈ£ü</h2>
                <button class="close-btn" onclick="closeAddMealModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Áî®È§êÁ±ªÂûã</label>
                    <div class="meal-type-selector">
                        <div class="meal-type-option selected" data-type="breakfast" onclick="selectMealType(this)">
                            <div class="icon">üåÖ</div>
                            <div class="name">Êó©È§ê</div>
                        </div>
                        <div class="meal-type-option" data-type="lunch" onclick="selectMealType(this)">
                            <div class="icon">‚òÄÔ∏è</div>
                            <div class="name">ÂçàÈ§ê</div>
                        </div>
                        <div class="meal-type-option" data-type="dinner" onclick="selectMealType(this)">
                            <div class="icon">üåô</div>
                            <div class="name">ÊôöÈ§ê</div>
                        </div>
                        <div class="meal-type-option" data-type="snack" onclick="selectMealType(this)">
                            <div class="icon">üçø</div>
                            <div class="name">Âä†È§ê</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Áî®È§êÊó∂Èó¥</label>
                    <input type="datetime-local" id="mealTime" />
                </div>

                <div class="form-group">
                    <label>‰∏ä‰º†È£üÁâ©ÁÖßÁâáÔºàAIËá™Âä®ËØÜÂà´Ôºâ</label>
                    <div class="photo-upload" id="photoUpload" onclick="document.getElementById('foodPhoto').click()">
                        <input type="file" id="foodPhoto" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)" />
                        <div class="upload-hint" id="uploadHint">
                            <div class="icon">üì∑</div>
                            <p>ÁÇπÂáª‰∏ä‰º†È£üÁâ©ÁÖßÁâá</p>
                            <p style="font-size: 12px; margin-top: 5px;">ÊîØÊåÅAIËá™Âä®ËØÜÂà´È£üÁâ©</p>
                        </div>
                    </div>
                </div>

                <div class="ai-result" id="aiResult" style="display: none;">
                    <h4>ü§ñ AIËØÜÂà´ÁªìÊûú</h4>
                    <p id="aiResultText"></p>
                </div>

                <div class="form-group">
                    <label>Ê∑ªÂä†È£üÁâ©</label>
                    <div class="food-list" id="foodList">
                        <!-- Food items will be added here -->
                    </div>
                    <button class="add-food-btn" onclick="openFoodSearch()">
                        <span>+</span> Ê∑ªÂä†È£üÁâ©
                    </button>
                </div>

                <div class="form-group">
                    <label>ÊÄªÂç°Ë∑ØÈáå</label>
                    <input type="number" id="totalCalories" placeholder="0" readonly />
                </div>

                <button class="submit-btn" onclick="saveMeal()">‰øùÂ≠òËÆ∞ÂΩï</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ ‰∏™‰∫∫ËµÑÊñô</h2>
                <button class="close-btn" onclick="closeProfileModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="bmi-display">
                    <div class="bmi-value" id="bmiDisplay">--</div>
                    <div class="bmi-status" id="bmiStatus">ËØ∑ËæìÂÖ•Ë∫´È´ò‰ΩìÈáç</div>
                </div>

                <div class="form-group">
                    <label>Ë∫´È´ò (cm)</label>
                    <input type="number" id="profileHeight" placeholder="175" onchange="updateBMI()" />
                </div>

                <div class="form-group">
                    <label>‰ΩìÈáç (kg)</label>
                    <input type="number" id="profileWeight" placeholder="70" onchange="updateBMI()" />
                </div>

                <div class="form-group">
                    <label>Âπ¥ÈæÑ</label>
                    <input type="number" id="profileAge" placeholder="25" />
                </div>

                <div class="form-group">
                    <label>ÊÄßÂà´</label>
                    <select id="profileGender">
                        <option value="male">Áî∑</option>
                        <option value="female">Â•≥</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Ê¥ªÂä®Èáè</label>
                    <select id="profileActivity">
                        <option value="1.2">‰πÖÂùê‰∏çÂä®</option>
                        <option value="1.375">ËΩªÂ∫¶Ê¥ªÂä®ÔºàÊØèÂë®1-3Ê¨°ËøêÂä®Ôºâ</option>
                        <option value="1.55">‰∏≠Â∫¶Ê¥ªÂä®ÔºàÊØèÂë®3-5Ê¨°ËøêÂä®Ôºâ</option>
                        <option value="1.725">È´òÂ∫¶Ê¥ªÂä®ÔºàÊØèÂë®6-7Ê¨°ËøêÂä®Ôºâ</option>
                        <option value="1.9">‰∏ì‰∏öËøêÂä®Âëò</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ÁõÆÊ†á</label>
                    <select id="profileGoal">
                        <option value="lose">ÂáèËÑÇ</option>
                        <option value="maintain">‰øùÊåÅ</option>
                        <option value="gain">Â¢ûËÇå</option>
                    </select>
                </div>

                <button class="submit-btn" onclick="saveProfile()">‰øùÂ≠òËµÑÊñô</button>
            </div>
        </div>
    </div>

    <!-- Food Search Modal -->
    <div class="modal" id="foodSearchModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîç ÊêúÁ¥¢È£üÁâ©</h2>
                <button class="close-btn" onclick="closeFoodSearch()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group food-search">
                    <input type="text" id="foodSearchInput" placeholder="ËæìÂÖ•È£üÁâ©ÂêçÁß∞..." oninput="searchFood(this.value)" />
                    <div class="food-search-results" id="foodSearchResults"></div>
                </div>

                <div id="manualFoodForm" style="margin-top: 20px;">
                    <div class="form-group">
                        <label>È£üÁâ©ÂêçÁß∞</label>
                        <input type="text" id="manualFoodName" placeholder="Â¶ÇÔºöÁ±≥È•≠" />
                    </div>
                    <div class="form-group">
                        <label>ÈáçÈáè/Êï∞Èáè</label>
                        <input type="text" id="manualFoodAmount" placeholder="Â¶ÇÔºö1Á¢ó„ÄÅ200g" />
                    </div>
                    <div class="form-group">
                        <label>Âç°Ë∑ØÈáå (kcal)</label>
                        <input type="number" id="manualFoodCalories" placeholder="Á∫¶Â§öÂ∞ëÂç°Ë∑ØÈáå" />
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <div class="form-group">
                            <label>ËõãÁôΩË¥®(g)</label>
                            <input type="number" id="manualFoodProtein" placeholder="0" />
                        </div>
                        <div class="form-group">
                            <label>Á¢≥Ê∞¥(g)</label>
                            <input type="number" id="manualFoodCarbs" placeholder="0" />
                        </div>
                        <div class="form-group">
                            <label>ËÑÇËÇ™(g)</label>
                            <input type="number" id="manualFoodFat" placeholder="0" />
                        </div>
                    </div>
                    <button class="submit-btn" onclick="addManualFood()">Ê∑ªÂä†</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="loading-gabe">üé©</div>
        <p>GËÉñÊ≠£Âú®ÂàÜÊûê‰∏≠...</p>
    </div>

    <script>
        // Data Store
        let userProfile = JSON.parse(localStorage.getItem('gabeDiet_profile')) || {};
        let meals = JSON.parse(localStorage.getItem('gabeDiet_meals')) || {};
        let currentDate = new Date();
        let currentMealType = 'breakfast';
        let currentFoods = [];

        // Food Database (simplified)
        const foodDatabase = [
            { name: 'Á±≥È•≠', calories: 116, protein: 2.6, carbs: 25, fat: 0.3, unit: '100g' },
            { name: 'ÁôΩÁ≤•', calories: 46, protein: 1.1, carbs: 9.9, fat: 0.2, unit: '100g' },
            { name: 'Èù¢Êù°', calories: 137, protein: 4.5, carbs: 28, fat: 0.8, unit: '100g' },
            { name: 'È¶íÂ§¥', calories: 223, protein: 7, carbs: 47, fat: 0.8, unit: '100g' },
            { name: 'ÂåÖÂ≠ê', calories: 227, protein: 7.3, carbs: 44, fat: 2.1, unit: '100g' },
            { name: 'È•∫Â≠ê', calories: 218, protein: 8.5, carbs: 32, fat: 5.8, unit: '100g' },
            { name: 'È∏°Ëõã', calories: 155, protein: 13, carbs: 1.1, fat: 11, unit: '1‰∏™' },
            { name: 'ÁÖéËõã', calories: 196, protein: 14, carbs: 1.2, fat: 15, unit: '1‰∏™' },
            { name: 'ÁâõÂ•∂', calories: 54, protein: 3, carbs: 4.7, fat: 3, unit: '100ml' },
            { name: 'Ë±ÜÊµÜ', calories: 31, protein: 3, carbs: 1.8, fat: 1.6, unit: '100ml' },
            { name: 'Èù¢ÂåÖ', calories: 265, protein: 9, carbs: 49, fat: 3.2, unit: '100g' },
            { name: 'ÁáïÈ∫¶Áâá', calories: 389, protein: 16.9, carbs: 66, fat: 6.9, unit: '100g' },
            { name: 'ËãπÊûú', calories: 52, protein: 0.3, carbs: 14, fat: 0.2, unit: '1‰∏™' },
            { name: 'È¶ôËïâ', calories: 89, protein: 1.1, carbs: 23, fat: 0.3, unit: '1Ê†π' },
            { name: 'Ê©ôÂ≠ê', calories: 47, protein: 0.9, carbs: 12, fat: 0.1, unit: '1‰∏™' },
            { name: 'È∏°ËÉ∏ËÇâ', calories: 165, protein: 31, carbs: 0, fat: 3.6, unit: '100g' },
            { name: 'ÁâõËÇâ', calories: 250, protein: 26, carbs: 0, fat: 15, unit: '100g' },
            { name: 'Áå™ËÇâ', calories: 242, protein: 27, carbs: 0, fat: 14, unit: '100g' },
            { name: 'È±ºËÇâ', calories: 206, protein: 22, carbs: 0, fat: 12, unit: '100g' },
            { name: 'Ëôæ', calories: 85, protein: 20, carbs: 0, fat: 0.5, unit: '100g' },
            { name: 'Ë±ÜËÖê', calories: 76, protein: 8, carbs: 1.9, fat: 4.8, unit: '100g' },
            { name: 'ÈùíËèú', calories: 25, protein: 1.5, carbs: 4.3, fat: 0.3, unit: '100g' },
            { name: 'Ë•øÁ∫¢Êüø', calories: 18, protein: 0.9, carbs: 3.9, fat: 0.2, unit: '100g' },
            { name: 'ÈªÑÁìú', calories: 16, protein: 0.7, carbs: 3.6, fat: 0.1, unit: '100g' },
            { name: 'ÂúüË±Ü', calories: 77, protein: 2, carbs: 17, fat: 0.1, unit: '100g' },
            { name: 'ÂèØ‰πê', calories: 42, protein: 0, carbs: 10.6, fat: 0, unit: '100ml' },
            { name: 'Âï§ÈÖí', calories: 43, protein: 0.5, carbs: 3.6, fat: 0, unit: '100ml' },
            { name: 'ÂíñÂï°', calories: 2, protein: 0.1, carbs: 0, fat: 0, unit: '100ml' },
            { name: 'Â•∂Ëå∂', calories: 65, protein: 1.2, carbs: 15, fat: 0.7, unit: '100ml' },
            { name: 'ËñØÁâá', calories: 536, protein: 7, carbs: 53, fat: 35, unit: '100g' },
            { name: 'Â∑ßÂÖãÂäõ', calories: 546, protein: 4.9, carbs: 61, fat: 31, unit: '100g' },
            { name: 'ÂÜ∞Ê∑áÊ∑ã', calories: 207, protein: 3.5, carbs: 24, fat: 11, unit: '100g' },
            { name: 'Ê±âÂ†°', calories: 295, protein: 17, carbs: 30, fat: 12, unit: '1‰∏™' },
            { name: 'Êä´Ëê®', calories: 266, protein: 11, carbs: 33, fat: 10, unit: '100g' },
            { name: 'ÁÇ∏È∏°', calories: 290, protein: 20, carbs: 8, fat: 19, unit: '100g' },
            { name: 'ËñØÊù°', calories: 312, protein: 3.4, carbs: 41, fat: 15, unit: '100g' },
            { name: 'ÂØøÂè∏', calories: 143, protein: 5, carbs: 28, fat: 1.5, unit: '100g' },
            { name: 'Ê≤ôÊãâ', calories: 33, protein: 2.9, carbs: 5, fat: 0.5, unit: '100g' },
            { name: 'ÂùöÊûú', calories: 607, protein: 20, carbs: 21, fat: 54, unit: '100g' },
            { name: 'ÈÖ∏Â•∂', calories: 72, protein: 3.5, carbs: 9, fat: 2.7, unit: '100g' }
        ];

        // AI Food Recognition (Simulated)
        const aiFoodRecognition = {
            'Á±≥È•≠': ['Á±≥È•≠', 'ÁôΩÁ±≥È•≠', 'Â§ßÁ±≥È•≠'],
            'Èù¢Êù°': ['Èù¢Êù°', 'ÊãâÈù¢', 'ÁâõËÇâÈù¢', 'Ê±§Èù¢'],
            'È•∫Â≠ê': ['È•∫Â≠ê', 'Ê∞¥È•∫', 'ÁÖéÈ•∫'],
            'Ê±âÂ†°': ['Ê±âÂ†°', 'Ê±âÂ†°ÂåÖ', '‰∏âÊòéÊ≤ª'],
            'Êä´Ëê®': ['Êä´Ëê®', 'ÊØîËê®'],
            'Ê≤ôÊãâ': ['Ê≤ôÊãâ', 'Ëî¨ËèúÊ≤ôÊãâ'],
            'Ê∞¥Êûú': ['ËãπÊûú', 'È¶ôËïâ', 'Ê©ôÂ≠ê', 'Ê∞¥Êûú'],
            'È•ÆÊñô': ['ÂèØ‰πê', 'Â•∂Ëå∂', 'ÂíñÂï°', 'È•ÆÊñô'],
            'Èõ∂È£ü': ['ËñØÁâá', 'Â∑ßÂÖãÂäõ', 'Èõ∂È£ü'],
            'ËÇâÁ±ª': ['È∏°ËÇâ', 'ÁâõËÇâ', 'Áå™ËÇâ', 'È±ºËÇâ']
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            init();
        });

        function init() {
            loadUserProfile();
            renderMeals();
            updateCalorieDisplay();
            generateAdvice();
            
            // Set default meal time to now
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('mealTime').value = now.toISOString().slice(0, 16);
        }

        // User Profile Functions
        function loadUserProfile() {
            if (userProfile.height) {
                document.getElementById('userHeight').textContent = userProfile.height + 'cm';
                document.getElementById('profileHeight').value = userProfile.height;
            }
            if (userProfile.weight) {
                document.getElementById('userWeight').textContent = userProfile.weight + 'kg';
                document.getElementById('profileWeight').value = userProfile.weight;
            }
            if (userProfile.age) {
                document.getElementById('profileAge').value = userProfile.age;
            }
            if (userProfile.gender) {
                document.getElementById('profileGender').value = userProfile.gender;
            }
            if (userProfile.activity) {
                document.getElementById('profileActivity').value = userProfile.activity;
            }
            if (userProfile.goal) {
                document.getElementById('profileGoal').value = userProfile.goal;
            }
            
            calculateBMI();
            calculateTargetCalories();
        }

        function calculateBMI() {
            if (userProfile.height && userProfile.weight) {
                const heightInM = userProfile.height / 100;
                const bmi = (userProfile.weight / (heightInM * heightInM)).toFixed(1);
                document.getElementById('userBMI').textContent = bmi;
                document.getElementById('bmiDisplay').textContent = bmi;
                
                let status = '';
                let statusClass = '';
                if (bmi < 18.5) {
                    status = 'ÂÅèÁò¶ - Â§öÂêÉÁÇπÂ•ΩÁöÑÔºÅ';
                    statusClass = 'underweight';
                } else if (bmi < 24) {
                    status = 'Ê≠£Â∏∏ - ÁªßÁª≠‰øùÊåÅÔºÅ';
                    statusClass = 'normal';
                } else if (bmi < 28) {
                    status = 'Ë∂ÖÈáç - Ê≥®ÊÑèÊéßÂà∂È•ÆÈ£ü';
                    statusClass = 'overweight';
                } else {
                    status = 'ËÇ•ËÉñ - ËØ•Âä®Ëµ∑Êù•‰∫ÜÔºÅ';
                    statusClass = 'obese';
                }
                document.getElementById('bmiStatus').textContent = status;
                document.getElementById('bmiStatus').className = 'bmi-status ' + statusClass;
            }
        }

        function calculateTargetCalories() {
            if (userProfile.height && userProfile.weight && userProfile.age && userProfile.gender) {
                // Mifflin-St Jeor Equation
                let bmr;
                if (userProfile.gender === 'male') {
                    bmr = 10 * userProfile.weight + 6.25 * userProfile.height - 5 * userProfile.age + 5;
                } else {
                    bmr = 10 * userProfile.weight + 6.25 * userProfile.height - 5 * userProfile.age - 161;
                }
                
                const activity = parseFloat(userProfile.activity || 1.2);
                let tdee = bmr * activity;
                
                // Adjust based on goal
                if (userProfile.goal === 'lose') {
                    tdee -= 500;
                } else if (userProfile.goal === 'gain') {
                    tdee += 500;
                }
                
                document.getElementById('targetCalories').textContent = Math.round(tdee);
            }
        }

        function updateBMI() {
            const height = document.getElementById('profileHeight').value;
            const weight = document.getElementById('profileWeight').value;
            
            if (height && weight) {
                const heightInM = height / 100;
                const bmi = (weight / (heightInM * heightInM)).toFixed(1);
                document.getElementById('bmiDisplay').textContent = bmi;
                
                let status = '';
                let statusClass = '';
                if (bmi < 18.5) {
                    status = 'ÂÅèÁò¶';
                    statusClass = 'underweight';
                } else if (bmi < 24) {
                    status = 'Ê≠£Â∏∏';
                    statusClass = 'normal';
                } else if (bmi < 28) {
                    status = 'Ë∂ÖÈáç';
                    statusClass = 'overweight';
                } else {
                    status = 'ËÇ•ËÉñ';
                    statusClass = 'obese';
                }
                document.getElementById('bmiStatus').textContent = status;
                document.getElementById('bmiStatus').className = 'bmi-status ' + statusClass;
            }
        }

        function saveProfile() {
            userProfile = {
                height: parseFloat(document.getElementById('profileHeight').value),
                weight: parseFloat(document.getElementById('profileWeight').value),
                age: parseInt(document.getElementById('profileAge').value),
                gender: document.getElementById('profileGender').value,
                activity: document.getElementById('profileActivity').value,
                goal: document.getElementById('profileGoal').value
            };
            
            localStorage.setItem('gabeDiet_profile', JSON.stringify(userProfile));
            loadUserProfile();
            updateCalorieDisplay();
            generateAdvice();
            closeProfileModal();
        }

        // Modal Functions
        function openProfileModal() {
            document.getElementById('profileModal').classList.add('active');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        function openAddMealModal() {
            currentFoods = [];
            renderFoodList();
            document.getElementById('addMealModal').classList.add('active');
            document.getElementById('aiResult').style.display = 'none';
            document.getElementById('photoUpload').classList.remove('has-image');
            document.getElementById('uploadHint').style.display = 'block';
            const img = document.getElementById('photoUpload').querySelector('img');
            if (img) img.remove();
        }

        function closeAddMealModal() {
            document.getElementById('addMealModal').classList.remove('active');
        }

        function selectMealType(element) {
            document.querySelectorAll('.meal-type-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            currentMealType = element.dataset.type;
        }

        // Photo Upload & AI Recognition
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const uploadDiv = document.getElementById('photoUpload');
                uploadDiv.classList.add('has-image');
                document.getElementById('uploadHint').style.display = 'none';
                
                const img = document.createElement('img');
                img.src = e.target.result;
                uploadDiv.appendChild(img);
                
                // Simulate AI analysis
                showLoading();
                setTimeout(() => {
                    hideLoading();
                    simulateAIRecognition();
                }, 1500);
            };
            reader.readAsDataURL(file);
        }

        function simulateAIRecognition() {
            // Randomly select foods for demo
            const possibleFoods = ['Á±≥È•≠', 'Èù¢Êù°', 'È•∫Â≠ê', 'Ê±âÂ†°', 'Ê≤ôÊãâ', 'Ê∞¥Êûú', 'È•ÆÊñô'];
            const detectedFoods = [];
            const numFoods = Math.floor(Math.random() * 3) + 1;
            
            for (let i = 0; i < numFoods; i++) {
                const randomFood = possibleFoods[Math.floor(Math.random() * possibleFoods.length)];
                const food = foodDatabase.find(f => f.name === randomFood);
                if (food) {
                    detectedFoods.push({
                        ...food,
                        amount: '1‰ªΩ',
                        multiplier: 1
                    });
                }
            }
            
            currentFoods = detectedFoods;
            renderFoodList();
            updateTotalCalories();
            
            const aiResult = document.getElementById('aiResult');
            const aiResultText = document.getElementById('aiResultText');
            aiResult.style.display = 'block';
            aiResultText.textContent = `AIËØÜÂà´Âà∞Ôºö${detectedFoods.map(f => f.name).join('„ÄÅ')}„ÄÇÂ∑≤Ëá™Âä®Ê∑ªÂä†Ëá≥È£üÁâ©ÂàóË°®ÔºåËØ∑Ê†∏ÂØπÊï∞Èáè/ÈáçÈáè„ÄÇ`;
        }

        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        // Food Management
        function openFoodSearch() {
            document.getElementById('foodSearchModal').classList.add('active');
            document.getElementById('foodSearchInput').value = '';
            document.getElementById('foodSearchInput').focus();
            document.getElementById('foodSearchResults').classList.remove('active');
        }

        function closeFoodSearch() {
            document.getElementById('foodSearchModal').classList.remove('active');
        }

        function searchFood(query) {
            const resultsDiv = document.getElementById('foodSearchResults');
            
            if (!query.trim()) {
                resultsDiv.classList.remove('active');
                return;
            }
            
            const matches = foodDatabase.filter(food => 
                food.name.includes(query) || query.includes(food.name)
            ).slice(0, 10);
            
            if (matches.length > 0) {
                resultsDiv.innerHTML = matches.map(food => `
                    <div class="food-search-item" onclick="selectFood('${food.name}')">
                        <span>${food.name}</span>
                        <span style="opacity: 0.6;">${food.calories} kcal/${food.unit}</span>
                    </div>
                `).join('');
                resultsDiv.classList.add('active');
            } else {
                resultsDiv.classList.remove('active');
            }
        }

        function selectFood(foodName) {
            const food = foodDatabase.find(f => f.name === foodName);
            if (food) {
                currentFoods.push({
                    ...food,
                    amount: food.unit,
                    multiplier: 1
                });
                renderFoodList();
                updateTotalCalories();
                closeFoodSearch();
            }
        }

        function addManualFood() {
            const name = document.getElementById('manualFoodName').value;
            const amount = document.getElementById('manualFoodAmount').value;
            const calories = parseFloat(document.getElementById('manualFoodCalories').value) || 0;
            const protein = parseFloat(document.getElementById('manualFoodProtein').value) || 0;
            const carbs = parseFloat(document.getElementById('manualFoodCarbs').value) || 0;
            const fat = parseFloat(document.getElementById('manualFoodFat').value) || 0;
            
            if (!name || !calories) {
                alert('ËØ∑Ëá≥Â∞ëÂ°´ÂÜôÈ£üÁâ©ÂêçÁß∞ÂíåÂç°Ë∑ØÈáå');
                return;
            }
            
            currentFoods.push({
                name,
                calories,
                protein,
                carbs,
                fat,
                amount: amount || '1‰ªΩ',
                multiplier: 1,
                unit: amount || '1‰ªΩ'
            });
            
            // Clear form
            document.getElementById('manualFoodName').value = '';
            document.getElementById('manualFoodAmount').value = '';
            document.getElementById('manualFoodCalories').value = '';
            document.getElementById('manualFoodProtein').value = '';
            document.getElementById('manualFoodCarbs').value = '';
            document.getElementById('manualFoodFat').value = '';
            
            renderFoodList();
            updateTotalCalories();
            closeFoodSearch();
        }

        function removeFood(index) {
            currentFoods.splice(index, 1);
            renderFoodList();
            updateTotalCalories();
        }

        function renderFoodList() {
            const listDiv = document.getElementById('foodList');
            if (currentFoods.length === 0) {
                listDiv.innerHTML = '';
                return;
            }
            
            listDiv.innerHTML = currentFoods.map((food, index) => `
                <div class="food-item">
                    <div class="food-info">
                        <h4>${food.name}</h4>
                        <p>${food.amount}</p>
                    </div>
                    <div class="food-calories">
                        <div class="cal">${Math.round(food.calories * food.multiplier)}</div>
                        <div class="weight">kcal</div>
                    </div>
                    <button onclick="removeFood(${index})" style="background: none; border: none; color: #ff6f69; font-size: 20px; cursor: pointer; margin-left: 10px;">√ó</button>
                </div>
            `).join('');
        }

        function updateTotalCalories() {
            const total = currentFoods.reduce((sum, food) => sum + (food.calories * food.multiplier), 0);
            document.getElementById('totalCalories').value = Math.round(total);
        }

        // Meal Management
        function saveMeal() {
            if (currentFoods.length === 0) {
                alert('ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏ÄÁßçÈ£üÁâ©');
                return;
            }
            
            const mealTime = document.getElementById('mealTime').value;
            const totalCalories = parseFloat(document.getElementById('totalCalories').value) || 0;
            
            const meal = {
                id: Date.now(),
                type: currentMealType,
                time: mealTime,
                foods: [...currentFoods],
                totalCalories: totalCalories,
                totalProtein: currentFoods.reduce((sum, f) => sum + (f.protein || 0) * f.multiplier, 0),
                totalCarbs: currentFoods.reduce((sum, f) => sum + (f.carbs || 0) * f.multiplier, 0),
                totalFat: currentFoods.reduce((sum, f) => sum + (f.fat || 0) * f.multiplier, 0)
            };
            
            const dateKey = formatDateKey(new Date(mealTime));
            if (!meals[dateKey]) {
                meals[dateKey] = [];
            }
            meals[dateKey].push(meal);
            
            localStorage.setItem('gabeDiet_meals', JSON.stringify(meals));
            
            closeAddMealModal();
            renderMeals();
            updateCalorieDisplay();
            generateAdvice();
        }

        function deleteMeal(mealId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) return;
            
            const dateKey = formatDateKey(currentDate);
            if (meals[dateKey]) {
                meals[dateKey] = meals[dateKey].filter(m => m.id !== mealId);
                localStorage.setItem('gabeDiet_meals', JSON.stringify(meals));
                renderMeals();
                updateCalorieDisplay();
                generateAdvice();
            }
        }

        function renderMeals() {
            const dateKey = formatDateKey(currentDate);
            const dayMeals = meals[dateKey] || [];
            const timelineDiv = document.getElementById('mealTimeline');
            const emptyDiv = document.getElementById('emptyMeals');
            
            // Update date display
            const today = new Date();
            const isToday = formatDateKey(currentDate) === formatDateKey(today);
            const isYesterday = formatDateKey(new Date(today.getTime() - 86400000)) === formatDateKey(currentDate);
            
            if (isToday) {
                document.getElementById('currentDate').textContent = '‰ªäÂ§©';
            } else if (isYesterday) {
                document.getElementById('currentDate').textContent = 'Êò®Â§©';
            } else {
                document.getElementById('currentDate').textContent = `${currentDate.getMonth() + 1}/${currentDate.getDate()}`;
            }
            
            if (dayMeals.length === 0) {
                timelineDiv.innerHTML = '';
                emptyDiv.style.display = 'block';
                return;
            }
            
            emptyDiv.style.display = 'none';
            
            const typeNames = {
                breakfast: 'Êó©È§ê',
                lunch: 'ÂçàÈ§ê',
                dinner: 'ÊôöÈ§ê',
                snack: 'Âä†È§ê'
            };
            
            const typeIcons = {
                breakfast: 'üåÖ',
                lunch: '‚òÄÔ∏è',
                dinner: 'üåô',
                snack: 'üçø'
            };
            
            timelineDiv.innerHTML = dayMeals.sort((a, b) => new Date(a.time) - new Date(b.time)).map(meal => `
                <div class="meal-item">
                    <div class="meal-header">
                        <div class="meal-type">
                            <div class="meal-icon ${meal.type}">${typeIcons[meal.type]}</div>
                            <div class="meal-info">
                                <h4>${typeNames[meal.type]}</h4>
                                <span>${new Date(meal.time).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="meal-calories">${Math.round(meal.totalCalories)} kcal</div>
                            <button onclick="deleteMeal(${meal.id})" style="background: none; border: none; color: #ff6f69; font-size: 18px; cursor: pointer;">√ó</button>
                        </div>
                    </div>
                    <div class="meal-foods">
                        ${meal.foods.map(food => `
                            <div class="food-tag">${food.name}</div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function changeDate(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            renderMeals();
            updateCalorieDisplay();
            generateAdvice();
        }

        // Calorie Display
        function updateCalorieDisplay() {
            const dateKey = formatDateKey(currentDate);
            const dayMeals = meals[dateKey] || [];
            
            const totalCalories = dayMeals.reduce((sum, meal) => sum + meal.totalCalories, 0);
            const totalProtein = dayMeals.reduce((sum, meal) => sum + meal.totalProtein, 0);
            const totalCarbs = dayMeals.reduce((sum, meal) => sum + meal.totalCarbs, 0);
            const totalFat = dayMeals.reduce((sum, meal) => sum + meal.totalFat, 0);
            
            const target = parseInt(document.getElementById('targetCalories').textContent) || 2000;
            
            document.getElementById('currentCalories').textContent = Math.round(totalCalories);
            
            // Update ring
            const circle = document.getElementById('calorieProgress');
            const circumference = 2 * Math.PI * 78;
            const offset = circumference - (Math.min(totalCalories / target, 1) * circumference);
            circle.style.strokeDashoffset = offset;
            
            // Update macros
            const proteinTarget = (target * 0.25 / 4);
            const carbsTarget = (target * 0.5 / 4);
            const fatTarget = (target * 0.25 / 9);
            
            document.getElementById('proteinValue').textContent = Math.round(totalProtein) + 'g';
            document.getElementById('carbsValue').textContent = Math.round(totalCarbs) + 'g';
            document.getElementById('fatValue').textContent = Math.round(totalFat) + 'g';
            
            document.getElementById('proteinBar').style.width = Math.min((totalProtein / proteinTarget) * 100, 100) + '%';
            document.getElementById('carbsBar').style.width = Math.min((totalCarbs / carbsTarget) * 100, 100) + '%';
            document.getElementById('fatBar').style.width = Math.min((totalFat / fatTarget) * 100, 100) + '%';
        }

        // Advice Generation
        function generateAdvice() {
            const dateKey = formatDateKey(currentDate);
            const dayMeals = meals[dateKey] || [];
            
            if (dayMeals.length === 0) {
                document.getElementById('adviceCard').style.display = 'none';
                return;
            }
            
            document.getElementById('adviceCard').style.display = 'block';
            
            const totalCalories = dayMeals.reduce((sum, meal) => sum + meal.totalCalories, 0);
            const target = parseInt(document.getElementById('targetCalories').textContent) || 2000;
            const remaining = target - totalCalories;
            
            let advice = '';
            
            if (remaining > 500) {
                advice = '‰Ω†‰ªäÂ§©ÂêÉÂæóÊúâÁÇπÂ∞ëÂì¶ÔºåÂèØ‰ª•ÈÄÇÂΩìË°•ÂÖÖ‰∏Ä‰∫õÂÅ•Â∫∑Èõ∂È£üÊàñÊ∞¥Êûú„ÄÇËÆ∞‰ΩèÔºåËøáÂ∫¶ËäÇÈ£ü‰∏çÂà©‰∫éË∫´‰ΩìÂÅ•Â∫∑ÔºÅ';
            } else if (remaining > 0) {
                advice = '‰ªäÂ§©ÁöÑÊëÑÂÖ•ÈáèÂæàÂêàÁêÜÔºåÁªßÁª≠‰øùÊåÅÔºÅÂ¶ÇÊûúÈ•ø‰∫ÜÔºåÂèØ‰ª•ÈÄâÊã©‰∏Ä‰∫õ‰ΩéÂç°Ëî¨ËèúÊàñËõãÁôΩË¥®Ë°•ÂÖÖ„ÄÇ';
            } else if (remaining > -300) {
                advice = 'Á®çÂæÆË∂ÖÂá∫‰∫Ü‰∏ÄÁÇπÁõÆÊ†áÔºå‰∏çËøáÊ≤°ÂÖ≥Á≥ªÔºÅÂª∫ËÆÆÊôö‰∏äÂ∞ëÂêÉÊàñ‰∏çÂêÉ‰∏ªÈ£üÔºåÂ§öÂêÉÁÇπËî¨Ëèú„ÄÇ';
            } else {
                advice = '‰ªäÂ§©ÊëÑÂÖ•Ë∂ÖÊ†áËæÉÂ§öÔºåÂª∫ËÆÆÂ¢ûÂä†ËøêÂä®ÈáèÊàñÊòéÂ§©ÈÄÇÂΩìÊéßÂà∂„ÄÇËÆ∞‰ΩèÔºåÂáèËÇ•ÊòØÈïøÊúüËøáÁ®ãÔºå‰∏çË¶ÅÂõ†‰∏ÄÂ§©ËÄåÊ≤Æ‰∏ßÔºÅ';
            }
            
            // Add meal timing advice
            const hasBreakfast = dayMeals.some(m => m.type === 'breakfast');
            const hasLunch = dayMeals.some(m => m.type === 'lunch');
            const hasDinner = dayMeals.some(m => m.type === 'dinner');
            
            if (!hasBreakfast) {
                advice += ' üí° ËÆ∞ÂæóÂêÉÊó©È§êÂì¶ÔºåÊó©È§êÊòØ‰∏ÄÂ§©‰∏≠ÊúÄÈáçË¶ÅÁöÑ‰∏ÄÈ§êÔºÅ';
            }
            
            document.getElementById('adviceText').textContent = advice;
        }

        // Utility Functions
        function formatDateKey(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
